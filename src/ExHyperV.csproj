<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <!-- ... 您的标准配置，保持不变 ... -->
        <OutputType>WinExe</OutputType>
        <TargetFramework>net8.0-windows</TargetFramework>
        <UseWPF>true</UseWPF>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <ApplicationIcon>applicationIcon.ico</ApplicationIcon>
        <Version>1.0.8</Version>
        <WpfUiGenerateDiagnosticMessages>False</WpfUiGenerateDiagnosticMessages>
        <SatelliteResourceLanguages>en;zh-Hans</SatelliteResourceLanguages>
        <DebugType Condition=" '$(Configuration)' == 'Release' ">none</DebugType>
        <DebugSymbols Condition=" '$(Configuration)' == 'Release' ">false</DebugSymbols>
    </PropertyGroup>

    <ItemGroup>
        <!-- ... 您的包引用，保持不变 ... -->
        <PackageReference Include="CommunityToolkit.Mvvm" Version="8.4.0" />
        <PackageReference Include="Microsoft.PowerShell.SDK" Version="7.4.0" />
        <PackageReference Include="Microsoft.Xaml.Behaviors.Wpf" Version="1.1.135" />
        <PackageReference Include="TaskScheduler" Version="2.12.2" />
        <PackageReference Include="WPF-UI" Version="4.0.0" />
        <PackageReference Include="WPF-UI.Tray" Version="4.0.0" />
    </ItemGroup>

    <ItemGroup>
        <!-- 最终的资源定义：所有 Assets 都作为资源嵌入 -->
        <Resource Include="Assets\**\*.*" />
    </ItemGroup>
    
    <ItemGroup>
        <!-- ... 自动生成的代码，保持不变 ... -->
        <Compile Update="Properties\Resources.Designer.cs">
            <DesignTime>True</DesignTime>
            <AutoGen>True</AutoGen>
            <DependentUpon>Resources.resx</DependentUpon>
        </Compile>
        <EmbeddedResource Update="Properties\Resources.resx">
            <Generator>PublicResXFileCodeGenerator</Generator>
            <LastGenOutput>Resources.Designer.cs</LastGenOutput>
        </EmbeddedResource>
    </ItemGroup>

    <!-- ========================================================================================= -->
    <!-- ===                        ExHyperV 终极发布后清理脚本 (封神版)                         === -->
    <!-- ========================================================================================= -->
    <Target Name="GodTierCleanupAfterPublish" AfterTargets="Publish">
        <Message Text="========== Starting God-Tier Cleanup Script... ==========" Importance="high" />

        <!-- === 第1级: 绝对安全区 (100% Safe to Remove) === -->
        <!-- 这些是与编译、调试、多平台支持相关的辅助文件，对运行时没有任何影响。-->
        <ItemGroup>
            <SafeToRemove Include="$(PublishDir)Microsoft.CodeAnalysis*.dll" />
            <SafeToRemove Include="$(PublishDir)zh-Hans\Microsoft.CodeAnalysis*.resources.dll" />
            <SafeToRemove Include="$(PublishDir)**\*.pdb" />
        </ItemGroup>
        <RemoveDir Directories="$(PublishDir)ref" />
        <Delete Files="@(SafeToRemove)" />
        <Message Text="--- [Level 1: SAFE] Removed Roslyn, ref folder, and PDB files." Importance="high" />
        
        <ItemGroup>
            <AllRuntimeDirs Include="$([System.IO.Directory]::GetDirectories('$(PublishDir)runtimes'))" />
            <SafeRuntimeDirsToRemove Include="@(AllRuntimeDirs)" Condition=" '%(Filename)' != 'win' AND '%(Filename)' != 'win-arm64' AND '%(Filename)' != 'win-x64' " />
        </ItemGroup>
        <RemoveDir Directories="@(SafeRuntimeDirsToRemove)" />
        <Message Text="--- [Level 1: SAFE] Removed non-Windows runtimes." Importance="high" />

        <!-- === 第2级: 低风险区 (Low Risk) === -->
        <!-- 这些是 PowerShell SDK 包含的、用于处理非常见场景的功能模块。
             您的应用极大概率用不到它们。如果未来需要支持相关功能，请注释掉对应的行。-->
        <ItemGroup>
            <!-- 数据库支持 (您的应用不使用) -->
            <LowRiskToRemove Include="$(PublishDir)System.Data.SqlClient.dll" />
            <LowRiskToRemove Include="$(PublishDir)runtimes\**\System.Data.SqlClient.dll" />
            <LowRiskToRemove Include="$(PublishDir)System.Data.OleDb.dll" />
            <LowRiskToRemove Include="$(PublishDir)runtimes\**\System.Data.OleDb.dll" />
            <LowRiskToRemove Include="$(PublishDir)System.Data.Odbc.dll" />
            <LowRiskToRemove Include="$(PublishDir)runtimes\**\System.Data.Odbc.dll" />
            
            <!-- Active Directory 支持 (您的应用是本地管理) -->
            <LowRiskToRemove Include="$(PublishDir)System.DirectoryServices.AccountManagement.dll" />
            <LowRiskToRemove Include="$(PublishDir)runtimes\**\System.DirectoryServices.AccountManagement.dll" />
            <LowRiskToRemove Include="$(PublishDir)System.DirectoryServices.Protocols.dll" />
            <LowRiskToRemove Include="$(PublishDir)runtimes\**\System.DirectoryServices.Protocols.dll" />
            
            <!-- 其他边缘功能 -->
            <LowRiskToRemove Include="$(PublishDir)System.Speech.dll" />
            <LowRiskToRemove Include="$(PublishDir)runtimes\**\System.Speech.dll" />
            <LowRiskToRemove Include="$(PublishDir)System.Web.Services.Description.dll" />
            <LowRiskToRemove Include="$(PublishDir)zh-Hans\System.Web.Services.Description.resources.dll" />
            <LowRiskToRemove Include="$(PublishDir)System.ServiceModel.Syndication.dll" />
            <LowRiskToRemove Include="$(PublishDir)JsonSchema.Net.dll" />
            <LowRiskToRemove Include="$(PublishDir)Json.More.dll" />
            <LowRiskToRemove Include="$(PublishDir)JsonPointer.Net.dll" />
        </ItemGroup>
        <Delete Files="@(LowRiskToRemove)" />
        <Message Text="--- [Level 2: LOW RISK] Removed Database, AD, and other optional modules." Importance="high" />

        <!-- === 第3级: 中风险区 (Medium Risk) === -->
        <!-- 这些模块的功能更通用，您的脚本有可能在不经意间使用到它们。
             我们通过实验证明可以移除，但如果未来功能扩展，需要特别留意。-->
        <ItemGroup>
            <!-- Windows 服务和事件日志管理 -->
            <MediumRiskToRemove Include="$(PublishDir)System.ServiceProcess.ServiceController.dll" />
            <MediumRiskToRemove Include="$(PublishDir)runtimes\**\System.ServiceProcess.ServiceController.dll" />
            <MediumRiskToRemove Include="$(PublishDir)System.Diagnostics.EventLog.dll" />
            <MediumRiskToRemove Include="$(PublishDir)runtimes\**\System.Diagnostics.EventLog.dll" />

            <!-- Markdown 渲染 (用于富文本帮助信息) -->
            <MediumRiskToRemove Include="$(PublishDir)Markdig.Signed.dll" />
        </ItemGroup>
        <Delete Files="@(MediumRiskToRemove)" />
        <Message Text="--- [Level 3: MEDIUM RISK] Removed Service/EventLog and Markdig." Importance="high" />

        <!-- === 第4级: 高风险区 (High Risk) === -->
        <!-- 这是您基于“只用于本地管理”这一核心前提做出的极限优化。
             移除此文件将彻底破坏 PowerShell 的远程处理能力。
             如果未来需要任何形式的远程管理，请务必注释掉此任务。-->
        <ItemGroup>
            <HighRiskToRemove Include="$(PublishDir)System.Private.ServiceModel.dll" />
            <HighRiskToRemove Include="$(PublishDir)zh-Hans\System.Private.ServiceModel.resources.dll" />
        </ItemGroup>
        <Delete Files="@(HighRiskToRemove)" />
        <Message Text="--- [Level 4: HIGH RISK] Removed ServiceModel (WCF). Remoting is disabled." Importance="high" />

    <Delete Files="@(FinalSprintToDelete)" />
    <Message Text="--- (Final Sprint) Force removed IO.Ports and MarkdownRender." Importance="high" />

        <Message Text="========== God-Tier Cleanup Script Finished. ==========" Importance="high" />
    </Target>

</Project>