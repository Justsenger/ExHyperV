<Page
    x:Class="ExHyperV.Views.Pages.MemoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewmodels="clr-namespace:ExHyperV.ViewModels"
    xmlns:converters="clr-namespace:ExHyperV.Converters"
    xmlns:properties="clr-namespace:ExHyperV.Properties"
    Title="MemoryPage"
    d:DataContext="{d:DesignInstance Type=viewmodels:MemoryPageViewModel, IsDesignTimeCreatable=True}"
    mc:Ignorable="d">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:InversePercentageConverter x:Key="InversePercentageConverter"/>
    </Page.Resources>

    <Grid>
        <StackPanel Margin="10,0,10,20" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}">
            <ui:Card Padding="12" Margin="10,15,10,0">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <ui:FontIcon FontSize="24" FontFamily="{DynamicResource SegoeFluentIcons}" Glyph="&#xF5ED;"/>
                        <TextBlock Text="{x:Static properties:Resources.VMMemory}" Margin="10,0,0,0" FontSize="16" VerticalAlignment="Center"/>
                    </StackPanel>
                    <ui:Button Command="{Binding RefreshVmDataCommand}" HorizontalAlignment="Right" Content="{x:Static properties:Resources.refresh}" Appearance="Secondary"/>
                </Grid>
            </ui:Card>
            <ItemsControl ItemsSource="{Binding VirtualMachinesMemory}" Margin="30,0,10,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type viewmodels:VirtualMachineMemoryViewModel}">
                        <ui:CardExpander Margin="0,5,0,0" Padding="8">
                            <ui:CardExpander.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <ui:FontIcon Grid.Row="0" Grid.RowSpan="2"
                     FontFamily="{DynamicResource SegoeFluentIcons}" 
                     Glyph="{Binding VmIconGlyph}" 
                     FontSize="28" 
                     Margin="0,0,10,0" 
                     VerticalAlignment="Center"/>

                                    <Grid Grid.Column="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Grid Grid.Row="0" MinHeight="32">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="10"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding VMName}" FontSize="16" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                            <TextBlock Grid.Column="2" Text="{Binding MemoryUsageText}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" VerticalAlignment="Center"/>
                                        </Grid>

                                        <Grid Grid.Row="1" Margin="0,5,10,5" Visibility="{Binding IsVmRunning, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Border CornerRadius="4" Height="8" Background="{DynamicResource ControlFillColorDefaultBrush}">
                                                <ProgressBar Value="{Binding UsagePercentage, Mode=OneWay}" 
                                 Foreground="{Binding UsageBarBrush, Mode=OneWay}"
                                 Maximum="100" Height="8" BorderThickness="0"/>
                                            </Border>
                                        </Grid>
                                    </Grid>
                                </Grid>
                            </ui:CardExpander.Header>
                            <Grid Margin="20,10,20,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,30,15">
                                    <TextBlock Text="{x:Static properties:Resources.StartupRAM}" FontSize="16" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Static properties:Resources.Description_StartupRAM}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,2,0,0"/>
                                </StackPanel>
                                <Grid Grid.Row="0" Grid.Column="1" VerticalAlignment="Center" Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ComboBox Text="{Binding StartupMB, UpdateSourceTrigger=PropertyChanged}" IsEditable="True">
                                        <ComboBoxItem Content="512"/>
                                        <ComboBoxItem Content="1024"/>
                                        <ComboBoxItem Content="2048"/>
                                        <ComboBoxItem Content="3072"/>
                                        <ComboBoxItem Content="4096"/>
                                        <ComboBoxItem Content="6144"/>
                                        <ComboBoxItem Content="8192"/>
                                        <ComboBoxItem Content="16384"/>
                                        <ComboBoxItem Content="24576"/>
                                        <ComboBoxItem Content="32768"/>
                                        <ComboBoxItem Content="65536"/>
                                    </ComboBox>
                                    <TextBlock Grid.Column="1" Text="MB" VerticalAlignment="Center" FontSize="14" Margin="10,0,0,0"/>
                                </Grid>

                                <StackPanel Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,30,15">
                                    <TextBlock Text="{x:Static properties:Resources.MemoryWeight}" FontSize="16" FontWeight="SemiBold"/>
                                    <TextBlock Text="{x:Static properties:Resources.Description_MemoryWeight}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,2,0,0" TextWrapping="Wrap"/>
                                </StackPanel>
                                <Grid Grid.Row="1" Grid.Column="1" VerticalAlignment="Center" Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Value="{Binding Priority}" Minimum="0" Maximum="100" TickFrequency="10" IsSnapToTickEnabled="True" TickPlacement="BottomRight" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Priority, StringFormat={}{0:F0}%}" Width="40" TextAlignment="Right" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </Grid>

                                <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Content="{x:Static properties:Resources.EnableDynamicMemory}" IsChecked="{Binding DynamicMemoryEnabled}" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>

                                <Grid Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" IsEnabled="{Binding DynamicMemoryEnabled}" Margin="20,0,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" MinWidth="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,30,15">
                                        <TextBlock Text="{x:Static properties:Resources.MinimumRAM}" FontSize="16" FontWeight="SemiBold"/>
                                        <TextBlock Text="{x:Static properties:Resources.Description_MinimumRAM}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,2,0,0" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    <Grid Grid.Row="0" Grid.Column="1" VerticalAlignment="Center" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox Text="{Binding MinimumMB, UpdateSourceTrigger=PropertyChanged}" IsEditable="True">
                                            <ComboBoxItem Content="512"/>
                                            <ComboBoxItem Content="1024"/>
                                            <ComboBoxItem Content="2048"/>
                                            <ComboBoxItem Content="3072"/>
                                            <ComboBoxItem Content="4096"/>
                                            <ComboBoxItem Content="6144"/>
                                            <ComboBoxItem Content="8192"/>
                                            <ComboBoxItem Content="16384"/>
                                            <ComboBoxItem Content="24576"/>
                                            <ComboBoxItem Content="32768"/>
                                            <ComboBoxItem Content="65536"/>
                                        </ComboBox>
                                        <TextBlock Grid.Column="1" Text="MB" VerticalAlignment="Center" FontSize="14" Margin="10,0,0,0"/>
                                    </Grid>
                                    <StackPanel Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,30,15">
                                        <TextBlock Text="{x:Static properties:Resources.MaximumRAM}" FontSize="16" FontWeight="SemiBold"/>
                                        <TextBlock Text="{x:Static properties:Resources.Description_MaximumRAM}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,2,0,0" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    <Grid Grid.Row="1" Grid.Column="1" VerticalAlignment="Center" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ui:TextBox Text="{Binding MaximumMB, UpdateSourceTrigger=PropertyChanged}" />
                                        <TextBlock Grid.Column="1" Text="MB" VerticalAlignment="Center" FontSize="14" Margin="10,0,0,0"/>
                                    </Grid>
                                    <StackPanel Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,30,0">
                                        <TextBlock Text="{x:Static properties:Resources.MemoryBuffer}" FontSize="16" FontWeight="SemiBold"/>
                                        <TextBlock Text="{x:Static properties:Resources.Description_MemoryBuffer}" Foreground="{DynamicResource TextFillColorSecondaryBrush}" FontSize="12" Margin="0,2,0,0" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    <Grid Grid.Row="2" Grid.Column="1" VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox Text="{Binding Buffer}" IsEditable="True">
                                            <ComboBoxItem Content="5"/>
                                            <ComboBoxItem Content="20"/>
                                            <ComboBoxItem Content="50"/>
                                            <ComboBoxItem Content="100"/>
                                            <ComboBoxItem Content="200"/>
                                            <ComboBoxItem Content="500"/>
                                            <ComboBoxItem Content="2000"/>
                                        </ComboBox>
                                        <TextBlock Grid.Column="1" Text="%" VerticalAlignment="Center" FontSize="14" Margin="10,0,0,0"/>
                                    </Grid>
                                </Grid>

                                <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
                                    <ui:Button Content="{x:Static properties:Resources.Reset}" Command="{Binding RevertChangesCommand}" Padding="20,8" MinWidth="100"/>
                                    <ui:Button Content="{x:Static properties:Resources.Apply}" Appearance="Primary" Margin="15,0,0,0" Command="{Binding SaveChangesCommand}" IsEnabled="{Binding IsDataValid}" Padding="20,8" MinWidth="100"/>
                                </StackPanel>
                            </Grid>
                        </ui:CardExpander>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

        </StackPanel>

        <ProgressBar Panel.ZIndex="1" VerticalAlignment="Top" Height="4" IsIndeterminate="True"
                     Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    </Grid>
</Page>